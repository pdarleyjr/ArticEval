<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluation Report - IPLC ArticEval</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .iplc-logo {
            height: 50px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .header-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .header-title {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
        }

        .header-subtitle {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 400;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .btn-secondary {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .btn-secondary:hover {
            background: #d5dbdb;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, #1f618d);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .report-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .main-report {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .report-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }

        .report-title {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .report-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .status-completed {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-draft {
            background: #fef9e7;
            color: #f39c12;
        }

        .patient-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .patient-info h3 {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .patient-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 12px;
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-size: 14px;
            color: #2c3e50;
            font-weight: 600;
        }

        .evaluation-sections {
            margin-top: 30px;
        }

        .section-header {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ecf0f1;
        }

        .section-content {
            margin-bottom: 30px;
        }

        .section-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .question-response {
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 14px;
            color: #5d6d7e;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .response-value {
            font-size: 14px;
            color: #2c3e50;
            font-weight: 500;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .response-textarea {
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-content {
            font-size: 14px;
            color: #5d6d7e;
            line-height: 1.6;
        }

        .summary-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        .stat-value {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }

        .ai-summary-card {
            border: 2px solid #e8f4f8;
            background: linear-gradient(135deg, #e8f4f8, #f0f8ff);
        }

        .ai-summary-content {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-style: italic;
            line-height: 1.6;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fee;
            color: #c0392b;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #c0392b;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .no-responses {
            background: #fff3cd;
            color: #856404;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-style: italic;
        }

        @media print {
            body {
                background: white;
            }
            
            .header-actions,
            .sidebar {
                display: none;
            }
            
            .container {
                max-width: none;
                padding: 0;
            }
            
            .report-container {
                grid-template-columns: 1fr;
                gap: 0;
            }
            
            .main-report {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                padding: 20px;
                flex-direction: column;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: stretch;
            }

            .header-actions .btn {
                flex: 1;
                justify-content: center;
            }

            .report-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .main-report {
                padding: 20px;
            }

            .report-title {
                font-size: 24px;
            }

            .patient-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <img src="/assets/images/iplc-logo.png" alt="IPLC Logo" class="iplc-logo">
                <div class="header-text">
                    <h1 class="header-title">Evaluation Report</h1>
                    <p class="header-subtitle">Institute for Professional Learning and Communication</p>
                </div>
            </div>
            <div class="header-actions">
                <a href="clinician-dashboard.html" class="btn btn-secondary">
                    ‚Üê Back to Dashboard
                </a>
                <button id="printReportBtn" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
                        <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
                    </svg>
                    Print Report
                </button>
                <button id="generateAISummaryBtn" class="btn btn-success">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M12.136.326A1.5 1.5 0 0 1 14 1.78V3h.5A1.5 1.5 0 0 1 16 4.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 13.5v-9a1.5 1.5 0 0 1 1.404-1.497L12.136.326zM14 2.78V3H2l9.137-.137a.5.5 0 0 1 .863.917zM2 4h12v9.5a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5V4z"/>
                    </svg>
                    Generate AI Summary
                </button>
            </div>
        </div>

        <div id="errorMessage" class="error-message" style="display: none;"></div>

        <div class="report-container">
            <div class="main-report">
                <div class="report-header">
                    <h2 id="reportTitle" class="report-title">Loading Evaluation Report...</h2>
                    <div id="reportStatus" class="report-status status-completed">Completed</div>
                    <div class="patient-info">
                        <h3>Patient Information</h3>
                        <div class="patient-details">
                            <div class="detail-item">
                                <div class="detail-label">Patient Name</div>
                                <div id="patientName" class="detail-value">Loading...</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Date of Birth</div>
                                <div id="patientDOB" class="detail-value">Loading...</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Age</div>
                                <div id="patientAge" class="detail-value">Loading...</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Gender</div>
                                <div id="patientGender" class="detail-value">Loading...</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Evaluation Date</div>
                                <div id="evaluationDate" class="detail-value">Loading...</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Clinician</div>
                                <div id="clinicianName" class="detail-value">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="evaluation-sections">
                    <h3 class="section-header">Evaluation Results</h3>
                    <div id="sectionsContainer">
                        <div class="section-item">
                            <div class="section-title">Loading evaluation data...</div>
                            <div class="question-response">
                                <div class="question-text">Please wait while the evaluation results are loaded.</div>
                                <div class="response-value">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="clinicalNotesSection" style="display: none;">
                    <h3 class="section-header">Clinical Notes</h3>
                    <div class="section-item">
                        <div id="clinicalNotes" class="response-value response-textarea"></div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="info-card">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                        </svg>
                        Summary
                    </h3>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <span class="stat-label">Template</span>
                            <span id="templateName" class="stat-value">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Completed</span>
                            <span id="completedDate" class="stat-value">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Responses</span>
                            <span id="totalResponses" class="stat-value">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Duration</span>
                            <span id="evaluationDuration" class="stat-value">--</span>
                        </div>
                    </div>
                </div>

                <div id="aiSummaryCard" class="info-card ai-summary-card" style="display: none;">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M12.136.326A1.5 1.5 0 0 1 14 1.78V3h.5A1.5 1.5 0 0 1 16 4.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 13.5v-9a1.5 1.5 0 0 1 1.404-1.497L12.136.326zM14 2.78V3H2l9.137-.137a.5.5 0 0 1 .863.917zM2 4h12v9.5a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5V4z"/>
                        </svg>
                        AI Clinical Summary
                    </h3>
                    <div id="aiSummaryContent" class="ai-summary-content">
                        AI summary will appear here...
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="editEvaluationBtn" class="btn btn-primary">
                        Edit Evaluation
                    </button>
                    <button id="exportPDFBtn" class="btn btn-secondary">
                        Export as PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentEvaluation = null;
        let currentTemplate = null;
        const urlParams = new URLSearchParams(window.location.search);
        const evaluationId = urlParams.get('id');

        document.addEventListener('DOMContentLoaded', async function() {
            if (!evaluationId) {
                showError('No evaluation ID provided. Redirecting to dashboard...');
                setTimeout(() => {
                    window.location.href = 'clinician-dashboard.html';
                }, 2000);
                return;
            }

            await loadEvaluation();
            setupEventListeners();
        });

        async function loadEvaluation() {
            try {
                const response = await fetch(`/api/forms/submissions/${evaluationId}`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'Failed to load evaluation');
                }

                currentEvaluation = result.data;
                await loadTemplate();
                renderEvaluation();
            } catch (error) {
                console.error('Error loading evaluation:', error);
                showError('Failed to load evaluation. Please try again or contact support.');
            }
        }

        async function loadTemplate() {
            try {
                const response = await fetch(`/api/forms/templates/${currentEvaluation.templateId}`);
                const result = await response.json();

                if (result.success) {
                    currentTemplate = result.data;
                }
            } catch (error) {
                console.error('Error loading template:', error);
                // Continue without template data
            }
        }

        function renderEvaluation() {
            if (!currentEvaluation) return;

            const data = currentEvaluation.data || {};
            const patientInfo = data.patientInfo || {};
            const responses = data.responses || {};

            // Basic evaluation info
            document.getElementById('reportTitle').textContent = 
                `${currentTemplate?.name || 'Evaluation'} - ${currentEvaluation.patientName || 'Unknown Patient'}`;
            
            // Status
            const statusElement = document.getElementById('reportStatus');
            statusElement.textContent = currentEvaluation.status.charAt(0).toUpperCase() + currentEvaluation.status.slice(1);
            statusElement.className = `report-status status-${currentEvaluation.status}`;

            // Patient information
            document.getElementById('patientName').textContent = 
                `${patientInfo.patientFirstName || ''} ${patientInfo.patientLastName || ''}`.trim() || 'Not specified';
            document.getElementById('patientDOB').textContent = patientInfo.patientDOB || 'Not specified';
            document.getElementById('patientAge').textContent = patientInfo.patientAge || calculateAgeFromDOB(patientInfo.patientDOB) || 'Not specified';
            document.getElementById('patientGender').textContent = patientInfo.patientGender || 'Not specified';
            document.getElementById('evaluationDate').textContent = patientInfo.evaluationDate || 'Not specified';
            document.getElementById('clinicianName').textContent = currentEvaluation.clinicianName || 'Not specified';

            // Sidebar stats
            document.getElementById('templateName').textContent = currentTemplate?.name || 'Unknown Template';
            document.getElementById('completedDate').textContent = currentEvaluation.completedAt ? 
                new Date(currentEvaluation.completedAt).toLocaleDateString() : 'Not completed';
            document.getElementById('totalResponses').textContent = Object.keys(responses).length;
            document.getElementById('evaluationDuration').textContent = calculateDuration();

            // Clinical notes
            if (patientInfo.clinicalNotes && patientInfo.clinicalNotes.trim()) {
                document.getElementById('clinicalNotesSection').style.display = 'block';
                document.getElementById('clinicalNotes').textContent = patientInfo.clinicalNotes;
            }

            // Render evaluation sections
            renderEvaluationSections();
        }

        function renderEvaluationSections() {
            const sectionsContainer = document.getElementById('sectionsContainer');
            const responses = currentEvaluation.data?.responses || {};
            const sections = currentTemplate?.sections || [];

            if (Object.keys(responses).length === 0) {
                sectionsContainer.innerHTML = `
                    <div class="no-responses">
                        No evaluation responses found.
                    </div>
                `;
                return;
            }

            if (sections.length === 0) {
                // If no template sections available, show responses directly
                renderDirectResponses(sectionsContainer, responses);
                return;
            }

            // Render organized by sections
            sectionsContainer.innerHTML = sections.map(section => {
                const sectionResponses = (section.questions || []).map(question => {
                    const response = responses[question.id];
                    if (!response) return null;
                    
                    return `
                        <div class="question-response">
                            <div class="question-text">${question.text}</div>
                            <div class="response-value ${question.type === 'textarea' ? 'response-textarea' : ''}">
                                ${formatResponse(response, question.type)}
                            </div>
                        </div>
                    `;
                }).filter(Boolean).join('');

                if (!sectionResponses) return '';

                return `
                    <div class="section-item">
                        <div class="section-title">${section.name}</div>
                        ${sectionResponses}
                    </div>
                `;
            }).filter(Boolean).join('');
        }

        function renderDirectResponses(container, responses) {
            container.innerHTML = `
                <div class="section-item">
                    <div class="section-title">Evaluation Responses</div>
                    ${Object.entries(responses).map(([questionId, response]) => `
                        <div class="question-response">
                            <div class="question-text">Question ${questionId}</div>
                            <div class="response-value">${response}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function formatResponse(response, type) {
            if (type === 'scale') {
                return `${response}/10`;
            }
            if (Array.isArray(response)) {
                return response.join(', ');
            }
            return response;
        }

        function calculateAgeFromDOB(dob) {
            if (!dob) return null;
            const birthDate = new Date(dob);
            const today = new Date();
            const age = Math.floor((today - birthDate) / (365.25 * 24 * 60 * 60 * 1000));
            return age >= 0 ? age : null;
        }

        function calculateDuration() {
            if (!currentEvaluation.createdAt || !currentEvaluation.completedAt) {
                return 'Not available';
            }
            
            const start = new Date(currentEvaluation.createdAt);
            const end = new Date(currentEvaluation.completedAt);
            const diffMs = end - start;
            const diffMins = Math.round(diffMs / (1000 * 60));
            
            if (diffMins < 60) {
                return `${diffMins} minutes`;
            } else {
                const hours = Math.floor(diffMins / 60);
                const mins = diffMins % 60;
                return `${hours}h ${mins}m`;
            }
        }

        function setupEventListeners() {
            document.getElementById('printReportBtn').addEventListener('click', printReport);
            document.getElementById('generateAISummaryBtn').addEventListener('click', generateAISummary);
            document.getElementById('editEvaluationBtn').addEventListener('click', editEvaluation);
            document.getElementById('exportPDFBtn').addEventListener('click', exportPDF);
        }

        function printReport() {
            window.print();
        }

        async function generateAISummary() {
            try {
                const button = document.getElementById('generateAISummaryBtn');
                const originalText = button.innerHTML;
                button.innerHTML = '<div class="loading-spinner"></div>Generating...';
                button.disabled = true;

                const response = await fetch(`/api/ai/summary/${evaluationId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('aiSummaryCard').style.display = 'block';
                    document.getElementById('aiSummaryContent').textContent = result.data.summary;
                } else {
                    throw new Error(result.message || 'Failed to generate AI summary');
                }

                button.innerHTML = originalText;
                button.disabled = false;
            } catch (error) {
                console.error('Error generating AI summary:', error);
                showError('Failed to generate AI summary. Please try again.');
                
                const button = document.getElementById('generateAISummaryBtn');
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        function editEvaluation() {
            if (currentEvaluation) {
                window.location.href = `evaluation.html?id=${currentEvaluation.id}&template=${currentEvaluation.templateId}`;
            }
        }

        async function exportPDF() {
            try {
                const button = document.getElementById('exportPDFBtn');
                const originalText = button.innerHTML;
                button.innerHTML = '<div class="loading-spinner"></div>Exporting...';
                button.disabled = true;

                // Create a simplified version for PDF export
                const response = await fetch(`/api/reports/pdf/${evaluationId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `evaluation-report-${currentEvaluation.patientName || 'patient'}-${Date.now()}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    throw new Error('Failed to generate PDF');
                }

                button.innerHTML = originalText;
                button.disabled = false;
            } catch (error) {
                console.error('Error exporting PDF:', error);
                showError('Failed to export PDF. Please try again or use the print function.');
                
                const button = document.getElementById('exportPDFBtn');
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>